import { Server } from 'hyper-express';

import { RepositoryPostgresV1, UseCaseV1, HttpServiceHyperExpressV1 } from '@features/todo';

// Application initialization

let port = 8080;

// Repositories setup

const todoRepositoryPostgresV1 = new RepositoryPostgresV1();

// Use cases setup

const todoUseCaseV1 = new UseCaseV1(todoRepositoryPostgresV1);

// HTTP service setup, router and listener using HyperExpress

const hyperExpressApp = new Server();

const todoHttpServiceHyperExpressV1 = new HttpServiceHyperExpressV1(todoUseCaseV1);

hyperExpressApp.get('/todos', todoHttpServiceHyperExpressV1.getAll);
hyperExpressApp.post('/todo/add', todoHttpServiceHyperExpressV1.add);
hyperExpressApp.post('/todo/edit', todoHttpServiceHyperExpressV1.edit);
hyperExpressApp.post('/todo/remove', todoHttpServiceHyperExpressV1.remove);

hyperExpressApp.listen(port)
    .then(() => console.log(`HyperExpress runs on port: ${port}`))
    .catch((err) => console.log(err));
